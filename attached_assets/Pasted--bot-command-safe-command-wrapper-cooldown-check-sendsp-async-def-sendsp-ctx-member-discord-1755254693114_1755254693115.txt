@bot.command()
@safe_command_wrapper
@cooldown_check('sendsp')
async def sendsp(ctx, member: discord.Member, amount: int):
    """Send Spirit Points to another user (Owner only) - FIXED"""
    try:
        # Check if user has the Owner role
        user_role_ids = [role.id for role in ctx.author.roles]
        if ROLE_ID_OWNER not in user_role_ids:
            embed = discord.Embed(
                title="ğŸ‘‘ **OWNER ACCESS REQUIRED** ğŸ‘‘",
                description=(
                    "```\n"
                    "âš¡ This power belongs to the supreme ruler alone...\n"
                    "```"),
                color=0xFF0000)
            result, error = await light_safe_api_call(ctx.send, embed=embed)
            return

        # Validate amount
        if amount <= 0:
            embed = discord.Embed(
                title="âŒ **INVALID AMOUNT** âŒ",
                description="``````",
                color=0xFF4500)
            result, error = await light_safe_api_call(ctx.send, embed=embed)
            return

        if amount > 1000000:
            embed = discord.Embed(
                title="âš ï¸ **AMOUNT TOO LARGE** âš ï¸",
                description=f"``````",
                color=0xFF4500)
            result, error = await light_safe_api_call(ctx.send, embed=embed)
            return

        if member.bot:
            embed = discord.Embed(
                title="ğŸ¤– **INVALID TARGET** ğŸ¤–",
                description="``````",
                color=0xFF4500)
            result, error = await light_safe_api_call(ctx.send, embed=embed)
            return

        # Get receiver data
        receiver_id = str(member.id)
        receiver_data = get_user_data(receiver_id)  # This should be sync
        old_sp = receiver_data.get("sp", 0)
        new_sp = old_sp + amount

        # Update receiver's SP - FIXED: Use await
        success = await update_user_data(receiver_id, sp=new_sp)
        if not success:
            embed = discord.Embed(
                title="âŒ **DATABASE ERROR** âŒ",
                description="``````",
                color=0xFF0000)
            result, error = await light_safe_api_call(ctx.send, embed=embed)
            return

        # Log transaction - Make this async too if needed
        log_transaction(receiver_id, "owner_sp_grant", amount, old_sp, new_sp,
                        f"SP grant by Owner {ctx.author.display_name}")

        # Success embed
        embed = discord.Embed(
            title="ğŸ‘‘ **DIVINE SP BLESSING GRANTED** ğŸ‘‘",
            description=(
                "```\n"
                "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
                "âœ¨ The Owner channels raw spiritual energy âœ¨\n"
                "```"),
            color=0x9932CC)

        embed.add_field(
            name="ğŸ‘‘ **SUPREME OWNER**",
            value=f"`{ctx.author.display_name}`",
            inline=True)

        embed.add_field(
            name="ğŸ¯ **BLESSED RECIPIENT**",
            value=f"`{member.display_name}`",
            inline=True)

        embed.add_field(
            name="âš¡ **SPIRIT POINTS GRANTED**",
            value=f"`+{amount:,} SP`",
            inline=False)

        embed.add_field(
            name="ğŸ”‹ **NEW SP BALANCE**",
            value=f"`{new_sp:,} SP`",
            inline=False)

        embed.set_footer(
            text="ğŸ‘‘ Supreme Owner Privilege â€¢ Spirit Point Grant System",
            icon_url=ctx.author.avatar.url if ctx.author.avatar else None)
        embed.timestamp = datetime.datetime.now(timezone.utc)

        result, error = await safe_api_call(ctx.send, embed=embed)
        if error:
            logger.error(f"âŒ Failed to send message: {error}")

    except Exception as e:
        logger.error(f"âŒ Error in sendsp command: {e}")
        error_embed = discord.Embed(
            title="âŒ **SYSTEM ERROR** âŒ",
            description=f"``````",
            color=0xFF0000)
        result, error = await light_safe_api_call(ctx.send, embed=error_embed)